name: Keep Supabase Project Alive

on:
  schedule:
    # Run every 5 days at 2:00 AM UTC (projects pause after ~7 days of inactivity)
    - cron: '0 2 */5 * *'
  workflow_dispatch:

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Ping Supabase table (keep_alive)
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
        run: |
          set -e
          echo "Pinging Supabase table keep_alive..."
          # Replace keep_alive with a real table name; select a small column and limit 1
          resp=$(curl -s -o /dev/null -w "%{http_code}" \
            -X GET \
            -H "apikey: $SUPABASE_ANON_KEY" \
            -H "Authorization: Bearer $SUPABASE_ANON_KEY" \
            -H "Content-Type: application/json" \
            "${SUPABASE_URL}/rest/v1/keep_alive?select=id&limit=1")
          echo "HTTP response: $resp"
          if [ "$resp" != "200" ]; then
            echo "Unexpected response $resp — check RLS / table permissions / keys"
            exit 1
          fi
          echo "✅ Pinged table successfully"
